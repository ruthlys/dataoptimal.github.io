---
title: "test"
output: html_document
---

```{r echo=FALSE, fig.height=6, fig.width=11.5, message=FALSE, warning=FALSE}
# heatmap for ANOVA 0.01 and identified compounds with AMDIS
library(data.table)
library(plotly)
data.norm = data.frame(fread("/Users/ruthschmidt/Dropbox/Work/INRS/Data/NI_experiment/Files/VOC/data_normalized.csv", header=T))

# Get anova file 
aov = data.frame(fread("/Users/ruthschmidt/Dropbox/Work/INRS/Data/NI_experiment/Files/VOC/anova_0.01_cpds_id_final.csv", sep=",", header=T))
# merge and subset data.norm based on aov 
merge.df = merge(aov, data.norm, by ="ID")
merge.df = merge.df[-c(1,3:11)]
# make compounds row names
merge.df = data.frame(merge.df[,-1], row.names=merge.df[,1])
merge.df = as.data.frame(t(merge.df))

# add treatment and date from mapping file 
treat = data.frame(fread("/Users/ruthschmidt/Dropbox/Work/INRS/Data/NI_experiment/Files/VOC/mapping_file.tsv", sep="\t", header=T))
treat = treat[order(treat$ID), ]
treat = data.frame(treat[,-1], row.names=treat[,1])
# combine treat and merge.df and set factors 
heat.df = cbind.data.frame(treat, merge.df)
heat.df$Treatment = as.factor(heat.df$Treatment)
heat.df$Date = as.factor(heat.df$Date)
# sort data based on treatment and date
heat.df = heat.df[order(heat.df$Treatment, heat.df$Date), ]

# plot 
library(heatmaply)
heatmap.cpds = heatmaply(normalize(x = heat.df), #set to heatmaply for interactive heatmap
          Colv = NULL,
          xlab = "Compound ID", #ylab = "Sample ID",
          method = "euclidean",
          margins = c(1, 1),
          # row_dend_left = TRUE,
          # plot_method = "ggplot",
          fontsize_col = 10,
          fontsize_row = 8,
          showticklabels = c(T,T),
          scale_fill_gradient_fun = ggplot2::scale_fill_gradient2(
    low = "#1B9E77", 
    high = "#D95F02",
    midpoint = 0.5,
    limits = c(0, 1)
          ))
          #file = c("heatmap.pdf")) # only saves in workdir
heatmap.cpds

```
